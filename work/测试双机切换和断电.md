# 测试双机切换和断电重启

## 双击切换

1. 查看双机状态

   ```shell
   crm_mon -fr1
   ```

2. 关闭应用或数据库

   关闭应用：

   ```shell
   stop_onip.sh
   ```

   关闭数据库：

   ```sql
   sqlplus / as sysdba
   shutdown immediate;
   ```

3. 查看是否自动切换

   ```shell
   crm_mon -fr1
   ```

   > ISSUE：　ＯＭDB 停止后不会自动切换
   >
   > ```shell
   > stopdb.sh      # 停止内存库
   > ```
   >
   > 解决：    由于存在`.update`文件， 导致不会自动切换 

## 断电重启

1. 查看双机状态

   ```shell
   crm_mon -fr1
   ```

2. 查看挂载状态

   ```shell
   df -h
   ```

3. 重启

   ```shell
   reboot
   ```

4. 查看是否自动挂载

   ```shell
   df -h
   ```

   > ISSUE: 一些硬盘没有自动挂载，挂载命令一般写在`/etc/fstab`或者`/etc/init.d/boot.local`内。
   >
   > 解决： 执行命令并将命令写入`/etc/init.d/boot.local`内。
   >
   > ```shell
   > mount -a
   > ```

5. 查看双机启动是否正常

   ```shell
   crm_mon -fr1
   ```

   