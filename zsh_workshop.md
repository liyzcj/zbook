# Zsh Workshop

## 介绍

　　所有用户与 UNIX 系统交互的方式都是他们的SHELL。SHELL 为用户运行程序，从运行中的进程导入或导出数据。它给了用户一个完成 UNIX 工作的环境。

　　如果配置正确，UNIX SHELL 会让系统使用起来更加方便和简单。如果你的 SHELL 没有按照你的喜好来配置，使用它可能会导致效率大大降低，令人头疼，并且有时候会产生有害的、意想不到的效果。

　　**本书并不是试图让你使用zsh。**如果你已经使用一个 SHELL 15年了，你需要一个更好地理由将它换为 zsh。（也许本书会为你提供一点点）

　　本书的目的是**如何使用zsh让你的 UNIX 体验更加高效和愉快**。我会告诉你很多操作和配置zsh的方法。
　　
　　本书主要分为三个部分：
　　- 配置————让 zsh 的行为完全符合你希望的方式。
　　- 编程————利用一切可能充分利用脚本和函数。
　　- 技巧————大量的操作技巧和方法。

### 为什么选择 zsh？

　　Zsh 可以说是**最强大的和可配置的** UNIX SHELL。如果有的话，只有极少的事情其他 SHELL 可以做而 zsh 不能做。这也是为什么本书推荐 zsh 的原因。

　　简而言之，它可以让你用更少的时间完成更多的工作。

#### 特色

　　下面是一些 zsh 的特色。

<TABLE>
<TR COLSPAN=3>
<TD>别名
<TD>任务控制
<TD>函数

<TR>
<TD>简单灵活的 I/O 控制
<TD>目录堆栈
<TD>命令历史

<TR>
<TD>命令行编辑(vi, emacs, 自定义)
<TD>完全键盘映射
<TD>查找用户名

<TR>
<TD>登录/注销控制
<TD>高级文件名补全
<TD>主机名补全

<TR>
<TD>用户名补全
<TD>历史补全
<TD>完全编程补全

<TR>
<TD>SHELL受限模式
<TD>协同进程
<TD>内置算法评估

<TR>
<TD>隐藏符号链接
<TD>本地变量
<TD>定时命令

<TR>
<TD>简单可扩展提示符
<TD>拼写纠正
<TD>进程替换

<TR>
<TD>底层 sh 语法
<TD>处理大参数列表
<TD>避免用户setup file

<TR>
<TD>列出变量
<TD>全局别名
<TD>信号陷阱处理
</TABLE>

### 本书不包括

Zsh 的优点并不能简单的描述完全。以下是并不包含的内容，如果你对这些感兴趣，你可以自己去研究：

- 扩展参数标志

有很多方法可以获得 zsh 的扩展参数。比如

```shell
man zshexpn
```

- 命令行编辑

Zsh 的命令行编辑完全支持编程和绑定。你可以写自己的函数来控制光标和命令行的内容。zsh 还支持 **emacs**，**vi** 命令。执行以下命令了解详细信息：

```shell
man zshzle
```

- 动态加载模块

你可以编写自己的函数并实时的添加它。Zsh 中的许多东西都是作为模块实现的，例如完成控制。执行如下命令了解详细信息：

```shell
man zshmodules
```

- 构造语法

很遗憾我没有时间完成控制编程这部分。 例如 if for which case 等等。也许这部分会以后添加。

## 配置 ZSH

### 初始文件

像许多的 SHELL 一样，zsh 处理许多系统和用户的初始配置文件。了解这些文件的读取顺序和导致文件被忽略的情况非常重要。否则，你的命令或者起始配置文件可能不会被 zsh 执行。

#### 启动过程

在下面的描述中，zsh 默认会查找用户家目录下的配置文件。如果你希望它查找其他目录的配置文件，将参数 ZDOTDIR 设置为你想要的目录。

当 zsh 启动时，以下文件会被读取：

1. 读取 **/etc/zshenv**

如果在 **/etc/zshenv** 中未设置 **RCS** 选项，所有其他文件都会被跳过。

2. 读取 **~/.zshenv**
3. 如果 SHELL 为 login shell，读取 **/etc/zprofile**,然后是**~/.zprofile**
4. 如果 SHELL 为交互 SHELL ，读取 **/etc/zshrc**，然后是**~/.zshrc**
5. 最后，如果为 login shell，读取 **/etc/zlogin**，然后是 **~/.zlogin**
6. 当用户注销时，读取 **/etc/zlogout**，然后是 **~/.zlogout**

#### 术语解释

- **login shell**：登录 shell 一般在登录时产生，即当你使用 /bin/login 或者其他接入程序时，例如 SSH、rlogin、telnet等。例如：

```shell
ssh HOST_NAME SOME_COMMAND
```

即启动一个登录 shell

- **交互 SHELL ：交互 SHELL 是一个会显示提示并允许用户使用命令交互的 SHELL。

#### 注意

除了 /etc 还有**另一个**目录可以作为全局配置读取。可以再安装时确定。

### 通过选项配置 zsh

Zsh 有超过**一百多**个选项来控制 zsh 各方面的行为。每个选项都有一个名字，可以被打开或者关闭。

Zsh 提供了一些方法来打开或者关闭这些选项。最简单的可能是下面这个：

```shell
setopt OPTION_NAME   # 打开选项
unsetopt OPTION_NAME # 关闭选项
```

Zsh 的选项是大小写不敏感的，并且下划线会被忽略。这样可以使选项的名字简答易读。按照惯例一般全部大写。

任何一个选项都可以在前面加上 'NO' 来关闭。例如，如果你想关闭蜂鸣声，可以使用如下命令：

```shell
setopt NO_BEEP
```

有一些选项其实是其他选项的替代名称。这样有助于向后兼容 BASH 或者 KSH。（详情见手册）